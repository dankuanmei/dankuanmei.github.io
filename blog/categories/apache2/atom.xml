<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Apache2 | ダン・クァン・ミン Blog]]></title>
  <link href="http://dankuanmei.github.io/blog/categories/apache2/atom.xml" rel="self"/>
  <link href="http://dankuanmei.github.io/"/>
  <updated>2015-08-09T13:42:00+09:00</updated>
  <id>http://dankuanmei.github.io/</id>
  <author>
    <name><![CDATA[ダン・クァン・ミン]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Install Apache2 and Passenger]]></title>
    <link href="http://dankuanmei.github.io/blog/2015/07/20/install-apache2-and-passenger/"/>
    <updated>2015-07-20T11:23:25+09:00</updated>
    <id>http://dankuanmei.github.io/blog/2015/07/20/install-apache2-and-passenger</id>
    <content type="html"><![CDATA[<h3>Update hệ thống và cài đặt cái gói build cơ bản</h3>

<pre><code>apt-get update
apt-get upgrade
apt-get install build-essential
</code></pre>

<h3>Cài đặt Ruby</h3>

<pre><code>curl -sSL https://rvm.io/mpapis.asc | gpg --import -
curl -sSL https://get.rvm.io | bash -s stable

rvm install 2.2.2
rvm use 2.2.2 --default
</code></pre>

<h3>Cài đặt Apache2 và Passenger</h3>

<pre><code>apt-get install apache2
passenger-install-apache2-module
</code></pre>

<h3>Config Apache2 với Passenger sau khi đã cài đặt xong Passenger</h3>

<p>Tạo file /etc/apache2/mods-available/passenger.load</p>

<pre><code>LoadModule passenger_module /home/root/.rvm/gems/ruby-2.2.2/gems/passenger-5.0.14/buildout/apache2/mod_passenger.so
</code></pre>

<p>Tạo file /etc/apache2/mods-available/passenger.conf</p>

<pre><code>&lt;IfModule mod_passenger.c&gt;
     PassengerRoot /home/deploy/.rvm/gems/ruby-2.2.2/gems/passenger-5.0.14
     PassengerDefaultRuby /home/deploy/.rvm/gems/ruby-2.2.2/wrappers/ruby
     PassengerMaxPoolSize 10
&lt;/IfModule&gt;
</code></pre>

<p>Run command</p>

<pre><code>a2enmod passenger
</code></pre>

<h3>Config app Rails và add domain/sub-domain</h3>

<p>Các bạn có thể tạo 1 file với tên bất kì trong thư mục /etc/apache2/sites-enabled</p>

<p>Như mình thì cứ mỗi 1 app Rails/PHP mình sẽ tạo 1 file ở đây, sau này mình muốn gỡ app nào đó đi mình chỉ cần xóa file đó là được.</p>

<p>Ví dụ với app Rails của mình gắn với domain: ruby.rocks, mình sẽ tạo file có tên là: ruby.rocks.conf có nội dung như sau:</p>

<pre><code>&lt;VirtualHost *:80&gt;
  ServerName ruby.rocks
  DocumentRoot /home/root/mania-rails-test/public
  RailsEnv production
    &lt;Directory /home/root/mania-rails-test/public&gt;
        Allow from all
        Options -MultiViews
        Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p>Giải thích các chỉ thị trong file này:</p>

<ul>
<li>VirtualHost *:80: bạn đang chỉ định rằng app này có thể được truy cập từ bên ngoài qua cổng 80</li>
<li>ServerName ruby.rocks: đây chính là tên miền mà bạn muốn gắn với app Rails này</li>
<li>DocumentRoot /home/root/mania-rails-test/public: đây là nơi để bạn define đường dẫn tới app Rails của bạn, và theo convention của Passenger thì sẽ là: $RAILS_ROOT_PATH + /public. Ví dụ app Rails của mình đặt tại /home/root/mania-rails-test/. Thì mình sẽ để là /home/root/mania-rails-test/public</li>
<li>RailsEnv production Môi trường khi chạy app Rails này</li>
<li>Tại thẻ Directory các bạn cũng để đường dẫn tới app Rails của mình giống như DocumentRoot</li>
<li>Các phần còn lại trong thẻ Directory các bạn giữ nguyên, chúng ta sẽ nói về phần này sau.</li>
</ul>


<p>Cuối cùng chạy command</p>

<pre><code>service apache2 restart
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setup Apache2 Virtual Host on Ubuntu]]></title>
    <link href="http://dankuanmei.github.io/blog/2015/07/04/setup-apache2-virtual-host-on-ubuntu/"/>
    <updated>2015-07-04T13:20:58+09:00</updated>
    <id>http://dankuanmei.github.io/blog/2015/07/04/setup-apache2-virtual-host-on-ubuntu</id>
    <content type="html"><![CDATA[<h2>Create the Directory Structure</h2>

<p>The first step that we are going to take is to make a directory structure that will hold the site data that we will be serving to visitors.</p>

<pre><code>sudo mkdir -p /var/www/example.local/public_html
</code></pre>

<h2>Grant Permissions</h2>

<p>Now we have the directory structure for our files, but they are owned by our root user. If we want our regular user to be able to modify files in our web directories, we can change the ownership by doing this:</p>

<pre><code>sudo chown -R $USER:$USER /var/www/example.local/public_html
</code></pre>

<p>We should also modify our permissions a little bit to ensure that read access is permitted to the general web directory and all of the files and folders it contains so that pages can be served correctly:</p>

<pre><code>sudo chmod -R 755 /var/www
</code></pre>

<h2>Create Demo Pages for Each Virtual Host</h2>

<pre><code>vim /var/www/example.local/public_html/index.html
</code></pre>

<p>In this file, create a simple HTML document that indicates the site it is connected to. My file looks</p>

<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Welcome to example.local!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Success!  The example.local virtual host is working!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h2>Enable mod rewrite(Optional)</h2>

<pre><code>sudo a2enmod rewrite
sudo service apache2 restart
</code></pre>

<h2>Create New Virtual Host Files</h2>

<p>Create the First Virtual Host File</p>

<pre><code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/example.local.conf
</code></pre>

<p>Open and Edit the file.</p>

<pre><code>sudo vim /etc/apache2/sites-available/example.local.conf
</code></pre>

<p>Sample</p>

<pre><code>&lt;VirtualHost *:80&gt;
    ServerAdmin admin@example.local
    ServerName example.local
    ServerAlias www.example.local
    DocumentRoot /var/www/example.local/public_html
    &lt;Directory /var/www/example.local/public_html&gt;
      AllowOverride all
    &lt;/Directory&gt;
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre>

<p>Save and close the file.</p>

<h2>Enable the New Virtual Host Files</h2>

<p>We can use the a2ensite tool to enable each of our sites like this:</p>

<pre><code>sudo a2ensite example.local.conf
</code></pre>

<p>When you are finished, you need to restart Apache to make these changes take effect:</p>

<pre><code>sudo service apache2 restart
</code></pre>

<h2>Set Up Local Hosts File (Optional)</h2>

<p>If you haven&rsquo;t been using actual domain names that you own to test this procedure and have been using some example domains instead, you can at least test the functionality of this process by temporarily modifying the hosts file on your local computer.
If you are on a Mac or Linux computer, edit your local file with administrative privileges by typing:</p>

<pre><code>sudo vim /etc/hosts
</code></pre>

<p>For the domains that I used in this guide, assuming that my VPS IP address is 111.111.111.111, I could add the following lines to the bottom of my hosts file:</p>

<pre><code>127.0.0.1   localhost
127.0.1.1   guest-desktop
111.111.111.111 example.local
</code></pre>

<h2>Test your Results</h2>

<p>Now that you have your virtual hosts configured, you can test your setup easily by going to the domains that you configured in your web browser:
<a href="http://example.local">http://example.local</a></p>
]]></content>
  </entry>
  
</feed>
